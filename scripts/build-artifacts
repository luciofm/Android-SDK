#!/bin/sh -ex

TMP=${TMP:-/tmp}

OUTPUT_REPO="https://strdeploy:${GH_TOKEN}@github.com/sharethrough/Android-SDK-Maven.git"
(
cd ${TMP}
rm -rf maven || true
git clone ${OUTPUT_REPO} maven
)

pwd
OUTPUT="${TMP}/maven/sharethrough-android-sdk-${TRAVIS_BUILD_NUMBER}"
cp build/outputs/aar/*.aar "${OUTPUT}.aar"
cp build/distributions/*.zip "${OUTPUT}.zip"
cd "${TMP}/maven"

git config --global user.email "travis-ci@sharethrough.com"
git config --global user.name "Automated Build"

git add .
git commit -m "Travis build ${TRAVIS_BUILD_NUMBER}"

git remote rm origin
git remote add origin ${OUTPUT_REPO}

git push origin master